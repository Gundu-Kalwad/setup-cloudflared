name: Minecraft Bedrock Server
on: workflow_dispatch

jobs:
  run-mc:
    runs-on: ubuntu-latest
    steps:
      - name: Install Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y unzip libcurl4 openssl python3-pip
          pip3 install gdown --break-system-packages

      - name: Download and Unzip
        run: |
          gdown --id 1JS1Yc3Mwm_sY-kHczKfYLauCZ2-V-ExB -O bedrock.zip
          unzip bedrock.zip -d .
          # This finds the bedrock_server file wherever it is and makes it executable
          find . -name "bedrock_server" -exec chmod +x {} +

      - name: Install Bore (Quick Install)
        run: |
          curl -L https://github.com | tar zx
          sudo mv bore /usr/local/bin/

      - name: Start Server and Tunnel
        run: |
          # Find the directory containing bedrock_server
          SERVER_DIR=$(dirname $(find . -name "bedrock_server" -type f | head -n 1))
          cd "$SERVER_DIR"
          
          echo "Starting Minecraft from: $SERVER_DIR"
          LD_LIBRARY_PATH=. ./bedrock_server &
          
          echo "Waiting 30s for the world to load..."
          sleep 30
          
          # Start the tunnel
          bore local 19132 --to bore.pub
