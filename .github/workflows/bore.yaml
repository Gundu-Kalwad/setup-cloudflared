name: Minecraft Bedrock (Auto-Fetch)
on: workflow_dispatch

jobs:
  run-mc:
    runs-on: ubuntu-latest
    steps:
      - name: Install Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y unzip libcurl4 openssl jq

      - name: Fetch and Setup Latest Server
        run: |
          # Automatically get the latest Linux download URL from Mojang's API
          URL=$(curl -s https://net-secondary.web.minecraft-services.net/api/v1.0/download/links | jq -r '.result.links[] | select(.downloadType=="serverBedrockLinux") | .downloadUrl')
          
          echo "Downloading from: $URL"
          curl -L -A "Mozilla/5.0" -o bedrock-server.zip "$URL"
          
          mkdir -p server
          unzip bedrock-server.zip -d server
          chmod +x server/bedrock_server

      - name: Start Global Tunnel
        run: |
          # Install Bore
          curl -fsSL https://trybore.com | bash
          
          # Start Minecraft in the background
          cd server
          LD_LIBRARY_PATH=. ./bedrock_server &
          
          # Give it a few seconds to load the world
          sleep 15
          
          # Expose Port 19132 (Default Bedrock Port)
          bore local 19132 --to bore.pub
