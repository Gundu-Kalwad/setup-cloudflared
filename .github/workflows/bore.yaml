name: Ultimate Minecraft Bedrock
on: workflow_dispatch

jobs:
  run-server:
    runs-on: ubuntu-latest
    steps:
      - name: Start Minecraft via Docker (Host Mode)
        run: |
          # --network host makes the Minecraft port 19132 
          # accessible directly on the runner's localhost
          docker run -d --network host -e EULA=TRUE itzg/minecraft-bedrock-server
          
          echo "Server is booting... waiting 40s for full startup"
          sleep 40

      - name: Tunnel via Pinggy (UDP Mode)
        run: |
          # -T and -o for non-interactive shell
          # u@ prefix for UDP protocol (required for Bedrock)
          ssh -T -o StrictHostKeyChecking=no -p 443 -R0:localhost:19132 u@a.pinggy.io
