name: Minecraft Bedrock (Auto-Fetch)
on: workflow_dispatch

jobs:
  run-mc:
    runs-on: ubuntu-latest
    steps:
      - name: Install Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y unzip libcurl4 openssl

      - name: Fetch Latest Minecraft Server
        run: |
          # Downloading the 1.21.60.10 version directly
          curl -L -A "Mozilla/5.0" -o bedrock.zip https://www.minecraft.net
          unzip bedrock.zip -d server
          chmod +x server/bedrock_server

      - name: Install Bore (Direct Binary)
        run: |
          # Download the Linux binary directly from GitHub to avoid the 'newline' error
          curl -L -o bore.tar.gz https://github.com
          tar -xf bore.tar.gz
          sudo mv bore /usr/local/bin/

      - name: Start Server & Global Tunnel
        run: |
          cd server
          # Start Minecraft in background
          LD_LIBRARY_PATH=. ./bedrock_server &
          
          echo "Waiting 20s for Minecraft to boot..."
          sleep 20
          
          # Start Bore on Port 19132
          bore local 19132 --to bore.pub
