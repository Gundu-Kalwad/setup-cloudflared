name: Minecraft Bedrock Server
on: workflow_dispatch

jobs:
  run-mc:
    runs-on: ubuntu-latest
    steps:
      - name: Install Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y unzip libcurl4 openssl python3-pip
          pip3 install gdown --break-system-packages

      - name: Download from Google Drive
        run: |
          gdown --id 1JS1Yc3Mwm_sY-kHczKfYLauCZ2-V-ExB -O bedrock.zip
          mkdir -p server
          unzip bedrock.zip -d server
          # Making everything executable in case of subfolders
          find server -type f -exec chmod +x {} +

      - name: Install Bore Tunnel
        run: |
          curl -L -o bore.tar.gz https://github.com
          tar -xf bore.tar.gz
          sudo mv bore /usr/local/bin/

      - name: Start Server and Tunnel
        run: |
          cd server
          # Finding the actual binary name if it's different
          BINARY=$(find . -name "bedrock_server" -type f)
          LD_LIBRARY_PATH=. $BINARY &
          sleep 20
          bore local 19132 --to bore.pub
